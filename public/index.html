<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Main Page</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="main.css">
        <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css" />
        <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
        <script src="https://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>
    </head>
    <body>
        <!--Main div-->
        <div data-role="page" id="page_Main">
            <br><br><br><br>
            <svg width="100%" height="100%" style="position:absolute;left:0%;top:0px">
                <rect x="20%" y="13.5%" width="190px" height="90px" style="fill:none;stroke:rgb(255, 223, 0);stroke-width:5;fill-opacity:0.1;stroke-opacity:0.9">
                Your browser does not support SVG
                </rect>
            </svg>

            <h1 class="main-title">Planet</h1>
            <h1 class="sec-title">Runner</h1>
            <a class="ui-btn" id="main_ButtonLogin">Login</a>
            <a class="ui-btn" id="main_ButtonCreate">Create Account</a>

        </div>
        
        <!--Login Div-->
        <div data-role="page" id="page_Login">
            <div data-role="header" id="login_DivHeader">
                <a class="ui-btn ui-btn-icon-left ui-icon-carat-l" id="login_ButtonBack">Back</a>
                <h1>Enter Login Details</h1>                
            </div>
            <div data-role="content" id="div_Login" class="ui-content">
                <input name="Name" id="login_TextUserN" type="text" 
                       data-clear-btn="false" placeholder="Name">       
                <input name="Password" id="login_TextUserPW" type="password" 
                       data-clear-btn="false" placeholder="Password">                
                <a class="ui-btn" id="login_ButtonLogin">Login</a>
                <div id="login_DivResult" class="functions" style="text-align: center"></div>
            </div>
        </div>
        
        <!--Create Div-->
        <div data-role="page" id="page_Create">
            <div data-role="header" id="create_DivHeader">
                <a class="ui-btn ui-btn-icon-left ui-icon-carat-l" id="create_ButtonBack">Back</a>
                <h1>Enter New Account Details</h1>                
            </div>
            <div data-role="content" id="div_Create" class="ui-content">
                <input name="Name" id="create_TextUserN" placeholder="Name" type="text" 
                       data-clear-btn="false">       
                <input name="Password" id="create_TextUserPW" placeholder="Password" type="password" 
                       data-clear-btn="false">
                <input name="Confirm Password" id="create_TextUserConPW" placeholder="Confirm Password" type="password" 
                       data-clear-btn="false">                
                <a class="ui-btn" id="create_ButtonCreate">Create Account</a>
                <div id="create_DivResult" class="functions" style="text-align: center"></div>
            </div>
        </div>
        
        <!--Loading Div-->
        <div data-role="page" id="page_Loading">
            <br>
            <br>
            <img src="ajax-loader.gif" alt="loader image" 
                 style="display: block; margin-left: auto;margin-right: auto"/>
        </div>

        <script>
            $(function(){
                
                $.ajaxSetup ({
                    cache: false
                }); 
                //URL used for user authentication and creation
                var URL = "https://rocky-chamber-3053.herokuapp.com";
                
                //Main page div
                var pageMain = "#page_Main";
                var mainButtonLogin = "#main_ButtonLogin";
                var mainButtonCreate = "#main_ButtonCreate";
                
                //Login page div
                var pageLogin = "#page_Login";
                var loginTextUserN = "#login_TextUserN";
                var loginTextUserPW = "#login_TextUserPW";
                var loginButtonBack = "#login_ButtonBack";
                var loginButtonLogin = "#login_ButtonLogin";
                var loginDivResult = "#login_DivResult";
                
                //Create Account page div
                var createLogin = "#page_Create";
                var createTextUserN = "#create_TextUserN";
                var createTextUserPW = "#create_TextUserPW";
                var createTextUserConPW = "#create_TextUserConPW";
                var createButtonCreate = "#create_ButtonCreate";
                var createButtonBack = "#create_ButtonBack";
                var createDivResult = "#create_DivResult";
                
                //Loading page div
                var pageLoading = "#page_Loading";                               
                
                //Button Click functions
                //Main Buttons
                $(mainButtonLogin).on('click', function(){
                    $.mobile.changePage("#page_Login", { transition: "slide", 
                        reverse: false, changeHash: false });
                });                
                $(mainButtonCreate).on('click', function(){
                    $.mobile.changePage("#page_Create", { transition: "slide", 
                        reverse: false, changeHash: false });
                });
                
                //Login buttons
                $(loginButtonBack).on('click', function(){
                    $(loginDivResult).html("");
                    $.mobile.changePage("#page_Main", { transition: "slide", 
                        reverse: true, changeHash: false });
                });
                
                $(loginButtonLogin).on('click', function(){
                    var jsonUrl = URL+"/login";
                    var hasName = $(loginTextUserN).val();
                    var hasPass = $(loginTextUserPW).val();
                    if(hasName && hasPass){
                        var userName = $(loginTextUserN).val();
                        var userPassword = $(loginTextUserPW).val();
                        var userDetails = {"username": userName, "password":userPassword};                        
                        $.mobile.changePage("#page_Loading", { transition: "none", 
                            reverse: false, changeHash: false });
                        
                        $.post(jsonUrl, userDetails)
                                .success(function(data){
                                    console.log("Success");
                                })
                                .error(function(data){
                                    console.log("Error occured with login");
                                    var htmlVal = "<p><b>Wrong User Name or Password</b><p>";
                                    $(loginDivResult)
                                            .css("color","red")
                                            .css("font-size","0.8em")
                                            .html(htmlVal);
                                    $.mobile.changePage("#page_Login", { transition: "none", 
                                        reverse: false, changeHash: false });
                                });
                    }else{
                        var htmlVal = "<p><b>Please enter User Name and Password</b><p>";
                        $(loginDivResult)
                                .css("color","red")
                                .css("font-size","0.8em")
                                .html(htmlVal);
                    }
                });
                
                //Create buttons
                $(createButtonBack).on('click', function(){
                   $.mobile.changePage("#page_Main", { transition: "slide", 
                        reverse: true, changeHash: false });
                   $(createDivResult).html("");
                });
                
                $(createButtonCreate).on('click', function(){
                   var jsonUrl = URL+"/create";
                   var hasName = $(createTextUserN).val();
                   var hasPass = $(createTextUserPW).val();
                   var hasConPass = $(createTextUserConPW).val();
                   
                   if(hasName && hasPass && hasConPass){
                       var userName = $(createTextUserN).val();
                       var userPass = $(createTextUserPW).val();
                       var userConPass = $(createTextUserConPW).val();
                       if(!(userPass === userConPass)){
                           var htmlVal = "<p><b>Passwords Do Not Match</b></p>";
                           $(createDivResult)
                                .css("color","red")
                                .css("font-size","0.8em")
                                .html(htmlVal);                           
                       }else{
                           $.mobile.changePage("#page_Loading", { transition: "none", 
                                reverse: false, changeHash: false });
                           var userDetails = {"username":userName,"password":userPass};
                           $.post(jsonUrl, userDetails)
                                   .success(function(data){
                                       console.log(data);
                                   })
                                   .error(function(data){
                                       console.log(data.responseText);
                                       var htmlVal = "<p><b>User Name Already in Use</b></p>";
                                       $(createDivResult)
                                                .css("color","red")
                                                .css("font-size","0.8em")
                                                .html(htmlVal);
                                       $.mobile.changePage("#page_Create", { transition: "none", 
                                            reverse: false, changeHash: false });
                                   });
                           
                       }
                   }else{
                       var htmlVal = "<p><b>Please Enter Required Details</b></p>";
                       $(createDivResult)
                                .css("color","red")
                                .css("font-size","0.8em")
                                .html(htmlVal);
                   }
                });
                
            });
            
        </script>
    </body>
</html>
