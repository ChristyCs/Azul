<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Level Test</title>
        <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
        <script type="text/javascript" src="http://cdn.gamequeryjs.com/jquery.gamequery.js"></script>        
        <style type="text/css">            
            html,body{                
                margin: 0;
                padding: 0;
                background: white;
            }
            #playGround{
                background-color: rgb(200,200,200);
                width: 568px;
                height: 320px;
            }
        </style>
    </head>
    <body>
        <div id="playGround">
            
        </div>
        <script>
            $(function(){
                var PLAYGROUND = "#playGround";
                var PLAYGROUND_WIDTH = $(PLAYGROUND).width();
                var PLAYGROUND_HEIGHT = $(PLAYGROUND).height();
                
                //--------------------------------------------------------------
                //--    Main Declaration
                //--------------------------------------------------------------                
                var keyUp = false;
                var keyDown = false;
                var keyLeft = false;
                var keyRight = false;
                
                var gameJson = {
                    "layers":{
                        "background":{
                           "src":"background.png",
                           "width":"200",
                           "height":"100",
                           "posx":"0",
                           "posy":"0"
                        },
                        "midground":{
                           "src":"midground.png",
                           "width":"200",
                           "height":"100",
                           "posx":"0",
                           "posy":"0"                            
                        },
                        "foreground":{
                           "src":"foreground.png",
                           "width":"200",
                           "height":"100",
                           "posx":"0",
                           "posy":"0"                            
                        }
                    }
                };
                var background = new $.gQ.Animation({imageURL: gameJson.layers.background.src});
                
                
                var ball = new $.gQ.Animation({imageURL: "ball.png"});
                
                $(PLAYGROUND).playground({height:PLAYGROUND_HEIGHT, width:PLAYGROUND_WIDTH});
                //$.playground().addSprite("bacground",{animation: testImage,posx: 20, posy: 20, width: 50});
                $.playground().addGroup("balls",{height:PLAYGROUND_HEIGHT,width:PLAYGROUND_WIDTH})
                        .addSprite("ball1",{animation: ball,posx: 20,posy:20})
                        .addSprite("ball2",{animation: ball,posx: 55,posy:45})
                        .end();
                
                //--------------------------------------------------------------
                //--    Game Mechanincs
                //--------------------------------------------------------------
                $.playground().registerCallback(function(){
                    updateKeys();                    
//                    if(keyUp){
//                        var newPos = ($("#testImage").y()-5);
//                        $("#testImage").y(newPos);
//                    }
//                    if(keyDown){
//                        var newPos = ($("#testImage").y()+5);
//                        $("#testImage").y(newPos);
//                    }
//                    if(keyLeft){
//                        var newPos = ($("#testImage").x()-5);
//                        $("#testImage").x(newPos);
//                    }

                    if(keyRight){
                        var newPos = ($("#ball1").x()+1);                        
                        $("#ball1").x(newPos);
                        var collided = $("#ball1").collision("#ball2,."+$.gQ.groupCssClass);
                        console.log(collided.length);
                                
                        
                    }
                },60);
                $.playground().startGame();
                
                //--------------------------------------------------------------
                //--    Keyboard
                //--------------------------------------------------------------
                var keys = [];
                for(var i = 0; i < 256; i++){
                    keys.push(false);
                }                
                var updateKeys = function(){
                    keyUp = keys[87];
                    keyDown = keys[83];
                    keyLeft = keys[65];
                    keyRight = keys[68];                    
                };
                
                var keydown = function(e){
                    if(e.keyCode<keys.length){
                        keys[e.keyCode] = true;
                    }
                };
                
                var keyup = function(e){
                    if(e.keyCode<keys.length){
                        keys[e.keyCode] = false;
                    }
                };
                
                $(document).keydown(function(e){
                    keydown(e);
                });
                $(document).keyup(function(e){                    
                    keyup(e);
                });
                               
            });
        </script>
    </body>
</html>
